import React,{useState} from 'react'; import { api } from '../api'; import { resolveImage } from '../utils'
export default function AdminPanel({onCreated}){
  const [p,setP]=useState({name:'',price:'',category:'',subcategory:'',imageUrl:''}); const [file,setFile]=useState(null); const [msg,setMsg]=useState('')
  const upload=async()=>{ if(!file) return; const fd=new FormData(); fd.append('image',file); const {data}=await api.post('/api/upload',fd,{headers:{'Content-Type':'multipart/form-data'}}); setP(v=>({...v,imageUrl:data.url})) }
  const submit=async(e)=>{ e.preventDefault(); setMsg(''); try{ const {data}=await api.post('/api/products',{...p,price:Number(p.price)}); setMsg('Producto creado ✔'); setP({name:'',price:'',category:'',subcategory:'',imageUrl:''}); setFile(null); onCreated?.(data) }catch(ex){ setMsg(ex.response?.data?.msg||'Error al crear') } }
  return(<div className='card p-4 my-6'><h3 className='font-bold mb-3'>Panel Admin — Crear producto</h3>{msg&&<p className='text-sm mb-2'>{msg}</p>}<form onSubmit={submit} className='grid grid-cols-1 md:grid-cols-2 gap-3'><input required className='input' placeholder='Nombre' value={p.name} onChange={e=>setP({...p,name:e.target.value})}/><input required className='input' placeholder='Precio' type='number' value={p.price} onChange={e=>setP({...p,price:e.target.value})}/><input required className='input' placeholder='Categoría' value={p.category} onChange={e=>setP({...p,category:e.target.value})}/><input required className='input' placeholder='Subcategoría' value={p.subcategory} onChange={e=>setP({...p,subcategory:e.target.value})}/><div className='flex items-center gap-2'><input className='input' placeholder='imageUrl (opcional si subís archivo)' value={p.imageUrl} onChange={e=>setP({...p,imageUrl:e.target.value})}/><input type='file' onChange={e=>setFile(e.target.files[0])}/><button type='button' onClick={upload} className='btn btn-primary'>Subir</button></div>{p.imageUrl&&<img src={resolveImage(p.imageUrl)} className='w-40 h-24 object-cover rounded-xl'/>}<div className='col-span-full'><button className='btn btn-primary'>Guardar</button></div></form></div>) }
